<!DOCTYPE html>
<html lang="vi-VN">

<head>
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no">
	<title>Tài khoản - Bản đồ Genshin Impact Tiếng Việt - Genshin Impact Map VN</title>
	<meta name="description" content="Bản đồ Genshin, Bản đồ Genshin Impact, Bản đồ rương Genshin Impact, Bản đồ genshin impact phong thần đồng, bản đồ genshin impact nham thần đồng, Genshin map, Genshin Impact map, Genshin Impact chest map, Genshin Impact map vn" />
	<link rel="canonical" href="https://genshin-map.github.io/main.html">
	<meta charset="utf-8">
	<meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
	<meta property="og:site_name" content="genshin-map.github.io" />
    <meta property="og:url" content="https://genshin-map.github.io/main.html" />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="imgs/cover.png" />
    <meta property="og:title" content="Bản đồ Genshin - Genshin Impact map" />
    <meta property="og:description" content="Bản đồ Genshin, Bản đồ Genshin Impact, Bản đồ rương Genshin Impact, Genshin map, Genshin Impact map, Genshin Impact chest map, Genshin Impact map vn" />
    <link rel="icon" type="image/png" href="favicon.png">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="css/bcat.css?v=0313" />
	
	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-555995DXBS"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'G-555995DXBS');
	</script>
	<!-- Facebook Pixel Code -->
	<script>
		!function(f,b,e,v,n,t,s){
			if(f.fbq)return;
			n=f.fbq=function(){n.callMethod?n.callMethod.apply(n,arguments):n.queue.push(arguments)};
			if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
			n.queue=[];t=b.createElement(e);t.async=!0;
			t.src=v;s=b.getElementsByTagName(e)[0];
			s.parentNode.insertBefore(t,s)
		}
		(window, document,'script','https://connect.facebook.net/en_US/fbevents.js');
		fbq('init', '366891697930745');
		fbq('track', 'PageView');
	</script>
	<noscript><img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=366891697930745&ev=PageView&noscript=1"/></noscript>
	<!-- End Facebook Pixel Code -->
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
</head>

<body>
	<nav class="navbar navbar-expand-md navbar-dark bg-dark">
		<div class="container-fluid">
	    	<a class="navbar-brand" href="/">Home</a>
	    </div>
	</nav>

	<main role="main" class="container bc-main pt-2">
	    
	    <h1 class="bd-title" id="content">Tiện ích</h1>

	    <hr class="mb-3"/>
	    <h2>Key - Định danh</h2>
	    <p>Mỗi người dùng sẽ được định danh bởi 1 Key. Mục đích để sao lưu dữ liệu dánh dấu. Hãy lưu lại key của bạn hoặc thêm số điện thoại vào.</p>
	    <div class="my-3 d-flex align-items-center">
	    	<button id="js-get-key" type="button" class="btn btn-primary mr-2">Hiện KEY</button>
	    	<button id="js-add-phone" type="button" class="d-none btn btn-primary mr-2">Thêm SDT</button>
	    	<button id="js-view-phone" type="button" class="d-none btn btn-primary mr-2">Xem SDT</button>
	    </div>
	    <hr class="mb-3"/>
	    <h2>Dữ liệu sao lưu</h2>
	    <p>Danh sách dữ liệu sao lưu hiển thị tại đây</p>
	    <div class="my-3 d-flex align-items-center">
	    	<button id="js-marked-backup-by-key" type="button" class="btn btn-primary mr-2">Lấy dữ liệu từ Key khác</button>
	    	<button id="js-marked-backup-upload" type="button" class="btn btn-primary mr-2">Tải dữ liệu lên máy chủ</button>
	    </div>
	    <hr class="mb-3"/>
	    <div class="table-responsive">
		    <table class="table table-striped" id="js-marked-backup-table">
		    	<thead>
		    		<tr>
		    			<th scope="col">#</th>
		    			<th scope="col">Ngày</th>
		    			<th scope="col">Tải về</th>
		    			<th scope="col">Số đánh dấu</th>
		    			<th scope="col">Khôi phục</th>
		    			<th scope="col">Data</th>
				    </tr>
				</thead>
				<tbody></tbody>
			</table>
		</div>
	</main>

	<script type="text/javascript">
		/* Begin create coookie us_id & bcgens_browserid */
		var Cookie={set:function(e,o,i){var t,r,n,s,d;i?((n=new Date).setTime(n.getTime()+24*i*60*60*1e3),s="; expires="+n.toGMTString()):s="",1===(d=location.host).split(".").length?document.cookie=e+"="+o+s+"; path=/":((r=d.split(".")).shift(),t="."+r.join("."),document.cookie=e+"="+o+s+"; path=/; domain="+t,null!=Cookie.get(e)&&Cookie.get(e)==o||(t="."+d,document.cookie=e+"="+o+s+"; path=/; domain="+t))},get:function(e){for(var o=e+"=",i=document.cookie.split(";"),t=0;t<i.length;t++){for(var r=i[t];" "==r.charAt(0);)r=r.substring(1,r.length);if(0==r.indexOf(o))return r.substring(o.length,r.length)}return null},erase:function(e){Cookie.set(e,"",-1)}};function bcgens_guid(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}var browser_id,bcgens_uuid=bcgens_guid();Cookie.get("bcgens_browserid")?(browser_id=Cookie.get("bcgens_browserid"),Cookie.set("bcgens_browserid",browser_id,365)):(browser_id=bcgens_uuid,Cookie.set("bcgens_browserid",browser_id,365)),Cookie.get("us_id")?(browser_id=Cookie.get("us_id"),Cookie.set("us_id",browser_id,365)):(browser_id=bcgens_uuid,Cookie.set("us_id",browser_id,365));
	</script>
	<script type="text/javascript">
		/* backup data marke everyday */
		function bc_backup_marked(){if(!Cookie.get("bcgens_last_backup")){var e=function(){for(var e=[],a=0;a<29;a++)for(var o=1;o<1200;o++){var t=a+"_"+o;localStorage.getItem(t)&&e.push(t)}return e}();e.length&&function(e){var a=Cookie.get("us_id"),o=Cookie.get("bcgens_browserid");$.ajax({type:"post",dataType:"JSON",url:"https://genshin.nhatkythuthuat.com/api/marked_log.php",data:{us_id:""+a,bcgens_browserid:""+o,markedLog:e},success:function(e){e.success?Cookie.set("bcgens_last_backup",1,1):e.errors,console.log(e)}})}(e)}}bc_backup_marked();
	</script>

	<script type="text/javascript">
		$(window).on("load",function(){
			$("body").on("click", "#js-get-key", function() {
				Swal.fire(Cookie.get("us_id"));
			});

			$("body").on("click", "#js-marked-backup-upload", function() {
				Cookie.set("bcgens_last_backup",-1,-1);
				bc_backup_marked();
				Swal.fire('Đã tải lên. Vui lòng không tải lên nhiều lần trong ngày.');
			});
		});
	</script>

	<script type="text/javascript">

		function user_add_phone(){
			
			$("body").on("click", "#js-add-phone", function() {

				var us_id = Cookie.get("us_id");
		        var bcgens_browserid = Cookie.get("bcgens_browserid");

				Swal.fire({
	                title: 'Cập nhật số điện thoại',
	                input: 'number',
	                showCancelButton: true,
	                confirmButtonText: 'Cập nhật',
	                showLoaderOnConfirm: true,
	                preConfirm: (phone) => {
	                    // console.log("phone",${phone});
	                    return $.ajax({
	                        type: 'POST',
	                        dataType: 'JSON',
	                        url: 'https://genshin.nhatkythuthuat.com/api/user.php',
	                        data: {
	                            tp: 'add_phone',
	                            phone: phone,
	                            us_id: us_id,
	                            bcgens_browserid: bcgens_browserid
	                        },
	                        success: function(result) {
	                            if (result.success) {
	                                Swal.fire(
	                                    'Thông báo!',
	                                    result.success.message,
	                                    'info'
	                                )
	                            } else if (result.errors) {
	                                Swal.fire(
	                                    'Thông báo!',
	                                    result.errors.message,
	                                    'info'
	                                )
	                            }
	                            return result;
	                        }
	                    })
	                },
	                allowOutsideClick: () => !Swal.isLoading()}).then((result) => {
	                if (result.success) {
	                    Swal.fire({
	                        title: 'Thành công',
	                    })
	                }
	            });
		    });
		}

		function get_marked_backup(){
	        var us_id = Cookie.get("us_id");
	        var bcgens_browserid = Cookie.get("bcgens_browserid");

	        $.ajax({
	            type: 'post',
	            url: 'https://genshin.nhatkythuthuat.com/api/marked_log.php',
	            data: {
	            	tp: 'get_marked',
	                us_id: ''+us_id,
	                bcgens_browserid: ''+bcgens_browserid
	            },
	            success: function(response) {
	                $('#js-marked-backup-table tbody').html(response);
	            }
	        });
	    }

	    function down_marked_backup(){
	    	$("body").on("click", ".js-marked-down", function() {
	    		var that = $(this);
	    		var file_name = that.attr('data-name');
	    		var file_data = that.attr('data-marked');

	    		var_temp_data = $(file_data).val();

		    	var eleLink = document.createElement('a');
		    	eleLink.download = 'genshin_markers_'+file_name+'.json';
		    	eleLink.style.display = 'none';
		    	var blob = new Blob([var_temp_data]);
		    	eleLink.href = URL.createObjectURL(blob);
		    	document.body.appendChild(eleLink);
		    	eleLink.click();
		    	document.body.removeChild(eleLink);
		    });
	    }

	    function restore_marked_backup(){
	    	$("body").on("click", ".js-marked-restore", function() {
	    		var that = $(this);
	    		var file_name = that.attr('data-name');
	    		var file_data = that.attr('data-marked');
	    		var var_temp_data = $(file_data).val();
	    		var_temp_data = JSON.parse(var_temp_data);

	    		Swal.fire({
					title: 'Bạn có chắc chưa?',
					icon: 'warning',
					showCancelButton: true,
					confirmButtonColor: '#3085d6',
					cancelButtonColor: '#d33',
					confirmButtonText: 'Có, khôi phục!'
				}).then((result) => {
					if (result.isConfirmed) {
						if (var_temp_data && var_temp_data.length > 1){
			    			// xoa danh gia cu
							for (var i = 0; i < 29; i++) {
								for (var j = 1; j < 1200; j++) {
									var key = i + "_" + j
									localStorage.removeItem(key);
								}
							}

							$.each(var_temp_data, function(key, value) {
								localStorage.setItem(value,"1");
							});
			    		}

						Swal.fire(
							'Thành công',
							'Dữ liệu đã được khôi phục',
							'success'
						)
					}
				})
		    });
	    }

	    function get_user_info(){
	    	var us_id = Cookie.get("us_id");
		    var bcgens_browserid = Cookie.get("bcgens_browserid");

	    	$.ajax({
	            type: 'post',
	            dataType: 'JSON',
	            url: 'https://genshin.nhatkythuthuat.com/api/user.php',
	            data: {
	            	tp: 'user_info',
	                us_id: ''+us_id,
	                bcgens_browserid: ''+bcgens_browserid
	            },
	            success: function(response) {
	                if (response == null){
						$('#js-add-phone').removeClass('d-none');
						user_add_phone();
						return;
	                } else {
	                	$('#js-view-phone').removeClass('d-none');
	                	$("body").on("click", "#js-view-phone", function() {
				        	Swal.fire(response.phone);
				        });
	                }
	            }
	        });
	    }

	    function get_marked_backup_by_key(){
	    	var us_id = Cookie.get("us_id");
		    var bcgens_browserid = Cookie.get("bcgens_browserid");

	    	$("body").on("click", "#js-marked-backup-by-key", function() {

				Swal.fire({
	                title: 'Nhập vào Key',
	                input: 'text',
	                showCancelButton: true,
	                confirmButtonText: 'Lấy dữ liệu',
	                showLoaderOnConfirm: true,
	                preConfirm: (key) => {
	                    // console.log("phone",${phone});
	                    return $.ajax({
	                        type: 'POST',
	                        url: 'https://genshin.nhatkythuthuat.com/api/marked_log.php',
	                        data: {
	                            tp: 'get_marked_by_key',
	                            us_id: ''+us_id,
	                            bcgens_browserid: ''+bcgens_browserid,
	                            key: key
	                        },
	                        success: function(response) {
	                        	$('#js-marked-backup-table tbody').html(response);
	                        }
	                    })
	                },
	                allowOutsideClick: () => !Swal.isLoading()}).then((result) => {
	                if (result.success) {
	                    Swal.fire({
	                        title: 'Thành công',
	                    })
	                }
	            });
		    });
	    }

	    get_user_info();
	    get_marked_backup();
	    get_marked_backup_by_key();
	    down_marked_backup();
	    restore_marked_backup();
	</script>
</body>
</html>